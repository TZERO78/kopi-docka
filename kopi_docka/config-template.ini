# Kopi-Docka Configuration Template
# Encoding: UTF-8
#
# This is a template configuration file for Kopi-Docka.
# Copy this file and modify it according to your needs.
#
# Default locations:
#   - User: ~/.config/kopi-docka/config.conf (recommended)
#   - System: /etc/kopi-docka.conf (for root/system-wide)
#
# Environment variable overrides:
#   - KOPIA_PASSWORD                         (overrides [kopia] password)
#   - KOPI_DOCKA_<SECTION>_<OPTION>=<value>  (e.g. KOPI_DOCKA_BACKUP_BASE_PATH=/data/backup)

[kopia]
# Path where Kopia repository will be stored
# Can be local path or cloud storage URL:
#   s3://<bucket>/path      - AWS S3
#   b2://<bucket>/path      - Backblaze B2
#   azure://<container>     - Azure Blob
#   gs://<bucket>/path      - Google Cloud Storage
# See: kopia repository create --help
repository_path = /backup/kopia-repository

# Repository password (auto-generated on first run if set to CHANGE_ME)
# IMPORTANT: Keep this password safe! Required for disaster recovery.
# Can be overridden by env KOPIA_PASSWORD.
password = CHANGE_ME_TO_A_SECURE_PASSWORD

# Compression algorithm (zstd [best], gzip, s2 [fast], none)
# zstd = best compression ratio, moderate speed (recommended)
# s2 = fastest, lower compression
# gzip = compatible, moderate
compression = zstd

# Encryption algorithm (AES256-GCM-HMAC-SHA256 recommended)
encryption = AES256-GCM-HMAC-SHA256

# Cache directory for Kopia (will be created if missing)
cache_directory = /var/cache/kopi-docka

[backup]
# Base path for temporary backup operations (supports ~ expansion)
base_path = /backup/kopi-docka

# Number of parallel workers for volume/database backups
# 'auto' = automatic based on RAM/CPU (recommended)
# Or specify integer 1-32
parallel_workers = auto

# Container operation timeouts (seconds)
stop_timeout = 30      # Max time to wait for container stop
start_timeout = 60     # Max time to wait for container start

# Enable database backups using native dump tools
# Supports: PostgreSQL, MySQL, MariaDB, MongoDB, Redis
database_backup = true

# Disaster recovery bundle settings
# Automatically create encrypted recovery bundle after successful backups
update_recovery_bundle = false
recovery_bundle_path = /backup/recovery
recovery_bundle_retention = 3    # Keep last N bundles

# Exclusion patterns (comma-separated, simple globs)
# Examples: node_modules, *.tmp, cache, */__pycache__/*, .git, *.log
exclude_patterns = 

# Optional backup hooks (absolute paths to executable scripts)
# Scripts receive environment variables:
#   KOPI_DOCKA_UNIT_NAME  = backup unit name
#   KOPI_DOCKA_UNIT_TYPE  = stack|standalone
# Exit code 0 = success, non-zero = abort backup
pre_backup_hook = 
post_backup_hook = 

[docker]
# Path to Docker socket
# Requires read & write access. Non-root users: add to 'docker' group
# sudo usermod -aG docker $USER && newgrp docker
socket = /var/run/docker.sock

# Timeout for docker-compose operations (seconds)
compose_timeout = 300

# Remove stopped containers before backup
# WARNING: This permanently removes stopped containers!
prune_stopped_containers = false

[retention]
# Kopia retention policy (number of snapshots to keep)
# These values are applied per backup unit
daily = 7       # Keep 7 daily snapshots
weekly = 4      # Keep 4 weekly snapshots  
monthly = 12    # Keep 12 monthly snapshots
yearly = 5      # Keep 5 yearly snapshots

[logging]
# Logging configuration
# Logs are automatically sent to systemd journal when running as service
# File logging is optional for additional persistence

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
level = INFO

# Optional log file path (leave empty to disable file logging)
# Empty = only journald/console output (recommended for systemd)
# Use /var/log for system-wide, ~/logs for user installs
file = 

# Log rotation settings (only used if file is set)
max_size_mb = 100      # Rotate when log reaches this size
backup_count = 5       # Keep this many old log files

# Note: When running under systemd, structured logging is automatic.
# View logs with: journalctl -u kopi-docka
# Filter by unit: journalctl -u kopi-docka UNIT=my-stack
# Show errors: journalctl -u kopi-docka -p err